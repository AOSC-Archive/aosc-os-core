# Autotools...

rm -rf "$PKGDIR"

# Runtime libraries installation.

cd build

make -C "${ARCH_TARGET[$ARCH]}"/libgcc install-shared DESTDIR="$PKGDIR"
rm `find "$PKGDIR" -name 'libgcc_eh.a'`

# Common runtimes.
RTLIBS="libatomic libgfortran libgomp libitm libquadmath \
        libsanitizer/asan libsanitizer/lsan libsanitizer/ubsan libstdc++-v3/src libvtv libgo"

# Intel Cilk Runtime is only for x86.
if [[ "${CROSS:-$ARCH}" = "amd64" ]]; then
    RTLIBS+=" libcilkrts"
fi

for lib in ${RTLIBS[@]}; do
    make -C "${ARCH_TARGET[$ARCH]}"/$lib DESTDIR="$PKGDIR" install-toolexeclibLTLIBRARIES
done

if [[ "${CROSS:-$ARCH}" != "armel" ]]; then
    make -C "${ARCH_TARGET[$ARCH]}"/libsanitizer/tsan DESTDIR="$PKGDIR" install-toolexeclibLTLIBRARIES
fi
make -C "${ARCH_TARGET[$ARCH]}"/libobjc DESTDIR="$PKGDIR" install-libs
make -C "${ARCH_TARGET[$ARCH]}"/libstdc++-v3/po DESTDIR="$PKGDIR" install
if [ "${CROSS:-$ARCH}" = "amd64" ]; then
    make -C "${ARCH_TARGET[$ARCH]}"/libmpx DESTDIR="$PKGDIR" install
    rm "$PKGDIR"/usr/lib64/libmpx.spec
fi

for lib in libgomp \
           libitm \
           libquadmath; do
    make -C "${ARCH_TARGET[$ARCH]}"/$lib DESTDIR="$PKGDIR" install-info
done

cd "$SRCDIR"

# Dumb RPM is confused with all those libraries.
chmod +x "$PKGDIR"/usr/lib{,32,64}/lib*.so*
