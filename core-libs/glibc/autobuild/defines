PKGNAME=glibc
PKGSEC=libs
PKGDEP="linux+api"
PKGDES="GNU C Library"

# The following configuration:
#
# 1.  Declares that libraries should be installed into /usr/lib instead of /lib64;
# 2.  Declares our bug tracking URL;
# 3.  Enables add-on support;
# 4.  Declares that Kernel verion 3.4.0 is the minimum accepted
#     (you may raise the version number as you like);
# 5.  Enables lock elision (essential for GUILE, and many others that is lock-sensitive);
# 6.  Enables deprecated NSL and RPC headers (<= 2.14) for compatibility;
# 7.  Enables obsolete RPC (Remote Procedural Call) support for compatibility;
# 8.  Ensures that static libraries are installed for development purposes;
# 9.  Enables tunables (allows for altering of runtime libraries);
# 10. Disables multiple architecture support (multiarch is not supported in AOSC OS);
# 11. Disables profiling support
#     (you may enable, using --enable-profile to your need, however this is not realistic in
#     a "Core" environment);
# 12. Disables "warning as error";
#
# For architectures other than PowerPC (32-bit), also:
#
# 13. Enables "bind now" (disables lazy binding) for extra security;
# 14. Enables stackguard randomization for extra security;
# 15. Enables stack protector for extra security.

AUTOTOOLS_AFTER="--libexecdir=/usr/lib \

                 --with-bugurl=https://github.com/AOSC-Dev/aosc-os-core \

                 --enable-add-ons \
                 --enable-kernel=3.4.0 \
                 --enable-lock-elision \
                 --enable-obsolete-nsl \
                 --enable-obsolete-rpc \
                 --enable-static \
                 --enable-tunables \

                 --disable-multi-arch \
                 --disable-profile \
                 --disable-werror"

if [[ "${CROSS:-$ARCH}" != "powerpc" ]]; then
    AUTOTOOLS_AFTER+=" --enable-bind-now \
                       --enable-stackguard-randomization \
                       --enable-stack-protector=strong "
fi

RPMEXTRAPROVIDE="rtld(GNU_HASH)"
NOSTATIC=no

AB_FLAGS_FTF=0
AB_FLAGS_SSP=0
AB_FLAGS_SPECS=0

if [[ "${CROSS:-$ARCH}" != "powerpc" ]]; then
    AB_FLAGS_O3=1
fi

# error: "SIG_BLOCK" is not defined [-Werror=undef]
# LTO breaks build with a warning-as-error, not taking the chances though.
NOLTO=yes

# Do not strip the library to provide sufficient symbols
# to assist debuggers
ABSTRIP=0

LOCALEGENVER="20160914"

# Merges locale-gen at Core 4.
PKGREP="locale-gen<=20160429"
PKGBREAK="locale-gen<=20160429"

PKGEPOCH=1
